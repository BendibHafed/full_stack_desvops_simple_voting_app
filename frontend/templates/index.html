<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Voting App</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>Voting App</h1>
  <div id="polls"></div>

  <script>
    async function loadPolls(){
      const r = await fetch('/api/polls');
      const polls = await r.json();
      const container = document.getElementById('polls');
      container.innerHTML = '';
      for(const p of polls){
        const div = document.createElement('div');
        div.innerHTML = `<h2>${p.question}</h2><div id="choices-${p.id}">Loading...</div>`;
        container.appendChild(div);
        loadChoices(p.id);
      }
    }

    async function loadChoices(pollId){
      const r = await fetch(`/api/polls/${pollId}/choices`);
      const choices = await r.json();
      const el = document.getElementById(`choices-${pollId}`);
      el.innerHTML = '';
      for(const c of choices){
        const btn = document.createElement('button');
        btn.textContent = `${c.text} - Votes: ${c.votes}`;
        btn.onclick = async () => {
          await fetch(`/api/polls/${pollId}/vote`, {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({choice_id: c.id})
          });
          loadChoices(pollId);
        };
        el.appendChild(btn);
      }
    }

    loadPolls();
  </script>
</body>
</html>
